<?php
define('SLIGHT_PHP_ROOT', __DIR__);

class_exists('SlightPHP', false) || require __DIR__ . '/SlightPHP.php';

/**
 * SlightPHP class loader
 * 
 * @author leohu
 *
 */
class SlightLoader
{
    /**
     * slight load class
     * 
     * @param string $className
     * @return boolean
     */
    public static function loadClass($className) {
        $className = ltrim($className, '\\');
        
        // load for plugins
        if($className{0} == 'S') {
            $path = SLIGHT_PHP_ROOT . '/plugins/' . self::toPath($className);
            if(self::loadFile($path)) {
                return true;
            }
        }
        
        // load for zbj core
        if('zbj_' == substr($className, 0, 4)) {
            $classNameNoPrefix = substr($className, 4);
            $path = SLIGHT_PHP_ROOT . '/zbjcore/' . self::toPath($classNameNoPrefix);
            if(self::loadFile($path)) {
                return true;
            }
        }
        
        // load slight php app
        $path = SlightPHP::$appDir . '/' . self::toPath($className);
        if(self::loadFile($path)) {
            return true;
        }
        
        return false;
    }
    
    /**
     * convert class name to file path
     * 
     * @param string $className
     * @return mixed
     */
    public static function toPath($className) {
        return str_replace(array('_', '\\'), '/', $className) . '.class.php';
    }
    
    /**
     * load file with file is exists test
     * 
     * @param string $path
     * @return boolean
     */
    public static function loadFile($path) {
        if(!file_exists($path)) {
            return false;
        }
        
        require_once $path;
        
        return true;
    }
    
}

// register autoloader
spl_autoload_register(array('SlightLoader', 'loadClass'));

